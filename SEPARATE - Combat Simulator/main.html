<html>
<head>
<link rel='stylesheet' href='styles.css'/>
</head>
<body>
	<div id='container'>
		<div class='background border spacing'>
			<h1>Global Inputs</h1>
			
			<div class='background sameLineBlock'>
				<ul>
					<li>
						<label for="simulations">Simulations:</label>
						<input type="text" id="simulations" name="simulations" value='1' size='2'>
					</li>
					<li>
						<p><strong>Armor Per Level</strong></p>
					</li>
					<li>
						<label for="lightArmorPerLvl">Light</label>
						<input type="text" id="lightArmorPerLvl" name="lightArmorPerLvl" value='0.3' size='2'>
						<label for="mediumArmorPerLvl">Medium</label>
						<input type="text" id="mediumArmorPerLvl" name="mediumArmorPerLvl" value='1' size='2'>
						<label for="heavyArmorPerLvl">Heavy</label>
						<input type="text" id="heavyArmorPerLvl" name="heavyArmorPerLvl" value='1.8' size='2'>
					</li>
					<li>
						<p><strong>Stats from Armor Per Level</strong></p>
					</li>
					<li>
						<label for="lightArmorStatsPerLvl">Light</label>
						<input type="text" id="lightArmorStatsPerLvl" name="lightArmorStatsPerLvl" value='1.05' size='2'>
						<label for="mediumArmorStatsPerLvl">Medium</label>
						<input type="text" id="mediumArmorStatsPerLvl" name="mediumArmorStatsPerLvl" value='1' size='2'>
						<label for="heavyArmorStatsPerLvl">Heavy</label>
						<input type="text" id="heavyArmorStatsPerLvl" name="heavyArmorStatsPerLvl" value='0.95' size='2'>
					</li>
					<li>
						<p><strong>Weapon Multipliers</strong></p>
					</li>
					<li>
						<label for="strWeapon">STR</label>
						<input type="text" id="strWeapon" name="strWeapon" value='1' size='2'>
						<label for="dexWeapon">DEX</label>
						<input type="text" id="dexWeapon" name="dexWeapon" value='1.2' size='2'>
						<label for="intWeapon">INT</label>
						<input type="text" id="intWeapon" name="intWeapon" value='1.5' size='2'>
					</li>
					<li>
						<p><strong>Stats from Equipment Per Level</strong></p>
					</li>
					<li>
						<label for="common">Common</label>
						<input type="text" id="common" name="common" value='1' size='2'>
						<label for="uncommon">Uncommon</label>
						<input type="text" id="uncommon" name="uncommon" value='1.02' size='2'>
						<label for="rare">Rare</label>
						<input type="text" id="rare" name="rare" value='1.05' size='2'>
						<label for="legendary">Legendary</label>
						<input type="text" id="legendary" name="legendary" value='1.09' size='2'>
						<label for="mythic">Mythic</label>
						<input type="text" id="mythic" name="mythic" value='1.15' size='2'>
					</li>
				</ul>
				<button onclick='startSimulation()'>Single</button>
			</div>
		</div>

		<!-- PLAYER 1 -->
		<div class='sidePanel background border spacing'>
			<h1>Player 1</h1>

			<ul class='alignLeft'>
				<li>
					<label for="p1Level">Level:</label>
					<input type="text" id="p1Level" name="p1Level" value='100' size='2'>
				</li>
				<li>
					<label for="p1Class">Class:</label>
					<select name="p1Class" id="p1Class">
						<option value="warrior">Warrior</option>
						<option value="berserker">Berserker</option>
						<option value="magicKnight">Magic Knight</option>
						<option value="fencer">Fencer</option>
						<option value="frostMage">Frost Mage</option>
						<option value="fireMage">Fire Mage</option>
						<option value="darkMage">Dark Mage</option>
						<option value="bloodMage">Blood Mage</option>
						<option value="scout">Scout</option>
						<option value="rogue">Rogue</option>
						<option value="demonHunter">Demon Hunter</option>
						<option value="assassin">Assassin</option>
					  </select>
				</li>
				<li>
					<label for="p1Strength">STR/Lvl:</label>
					<input type="text" id="p1Strength" name="p1Strength" value='20' size='2'>
				</li>
				<li>
					<label for="p1Dexterity">DEX/Lvl:</label>
					<input type="text" id="p1Dexterity" name="p1Dexterity" value='5' size='2'>
				</li>
				<li>
					<label for="p1Intelligence">INT/Lvl:</label>
					<input type="text" id="p1Intelligence" name="p1Intelligence" value='5' size='2'>
				</li>
				<li>
					<label for="p1Consitution">CON/Lvl:</label>
					<input type="text" id="p1Consitution" name="p1Consitution" value='15' size='2'>
				</li>
				<li>
					<label for="p1Luck">LUK/Lvl:</label>
					<input type="text" id="p1Luck" name="p1Luck" value='15' size='2'>
				</li>
				<li>
					<label for="p1GearType">Gear Type:</label>
					<select name="p1GearType" id="p1GearType">
						<option value="light">Light</option>
						<option value="medium">Medium</option>
						<option value="heavy">Heavy</option>
					  </select>
				</li>
				<li>
					<label for="p1GearRarity">Gear Rarity:</label>
					<select name="p1GearRarity" id="p1GearRarity">
						<option value="common">Common</option>
						<option value="uncommon">Uncommon</option>
						<option value="rare">Rare</option>
						<option value="legendary">Legendary</option>
						<option value="mythic">Mythic</option>
					  </select>
				</li>
			</ul>

		</div>
		<!-- MAIN PANEL -->
		<!--
		<div class='mainPanel background border spacing'> 
			<div>
				<button onclick='startSimulation()'>Single</button>
				<button onclick='startRecursiveSimulation()'>Recursive</button>
			</div>
			<h4>Gold/Xp/Quests</h4>
			<textarea id='output'></textarea>
			<h4>Suggested Class Dmg/Armor</h4>
			<textarea id='outputClassInfo'></textarea>
			<h4>Recursive Output of Player Stats</h4>
			<textarea id='outputPlayerStats'></textarea>
		</div>
		-->
		<!-- PLAYER 2 -->
		<div class='sidePanel background border spacing'>
			<h1>Player 2</h1>

			<ul class='alignLeft'>
				<li>
					<label for="p2Level">Level:</label>
					<input type="text" id="p2Level" name="p2Level" value='100' size='2'>
				</li>
				<li>
					<label for="p2Class">Class:</label>
					<select name="p2Class" id="p2Class">
						<option value="warrior">Warrior</option>
						<option value="berserker">Berserker</option>
						<option value="magicKnight">Magic Knight</option>
						<option value="fencer">Fencer</option>
						<option value="frostMage">Frost Mage</option>
						<option value="fireMage">Fire Mage</option>
						<option value="darkMage">Dark Mage</option>
						<option value="bloodMage">Blood Mage</option>
						<option value="scout">Scout</option>
						<option value="rogue">Rogue</option>
						<option value="demonHunter">Demon Hunter</option>
						<option value="assassin">Assassin</option>
					  </select>
				</li>
				<li>
					<label for="p2Strength">STR/Lvl:</label>
					<input type="text" id="p2Strength" name="p2Strength" value='20' size='2'>
				</li>
				<li>
					<label for="p2Dexterity">DEX/Lvl:</label>
					<input type="text" id="p2Dexterity" name="p2Dexterity" value='5' size='2'>
				</li>
				<li>
					<label for="p2Intelligence">INT/Lvl:</label>
					<input type="text" id="p2Intelligence" name="p2Intelligence" value='5' size='2'>
				</li>
				<li>
					<label for="p2Consitution">CON/Lvl:</label>
					<input type="text" id="p2Consitution" name="p2Consitution" value='15' size='2'>
				</li>
				<li>
					<label for="p2Luck">LUK/Lvl:</label>
					<input type="text" id="p2Luck" name="p2Luck" value='15' size='2'>
				</li>
				<li>
					<label for="p2GearType">Gear Type:</label>
					<select name="p2GearType" id="p2GearType">
						<option value="light">Light</option>
						<option value="medium">Medium</option>
						<option value="heavy">Heavy</option>
					  </select>
				</li>
				<li>
					<label for="p2GearRarity">Gear Rarity:</label>
					<select name="p2GearRarity" id="p2GearRarity">
						<option value="common">Common</option>
						<option value="uncommon">Uncommon</option>
						<option value="rare">Rare</option>
						<option value="legendary">Legendary</option>
						<option value="mythic">Mythic</option>
					  </select>
				</li>
			</ul>
		</div>
	</div>
</body>
<script>

/* Important Info

Should get 60 stats per level - 20 from base stat upgrades, 40 from equipment




*/


	var classes = {
		//STR Classes
		'warrior': {
			'mainStat': 'str',
			'weapons': 1,
			'twoHanded': false,
			'maxArmorReduc': 50,
			'healthMult': 3
		},
		'berserker': {
			'mainStat': 'str',
			'weapons': 1,
			'twoHanded': false,
			'maxArmorReduc': 40,
			'healthMult': 2.5
		},
		'magicKnight': {
			'mainStat': 'str',
			'weapons': 1,
			'twoHanded': false,
			'maxArmorReduc': 45,
			'healthMult': 2.8
		},
		'fencer': {
			'mainStat': 'str',
			'weapons': 1,
			'twoHanded': false,
			'maxArmorReduc': 35,
			'healthMult': 2.4
		},
		//DEX Classes
		'scout': {
			'mainStat': 'dex',
			'weapons': 1,
			'twoHanded': true,
			'maxArmorReduc': 30,
			'healthMult': 2.4
		},
		'rogue': {
			'mainStat': 'dex',
			'weapons': 2,
			'twoHanded': false,
			'maxArmorReduc': 25,
			'healthMult': 2.1
		},
		'demonHunter': {
			'mainStat': 'dex',
			'weapons': 1,
			'twoHanded': true,
			'maxArmorReduc': 35,
			'healthMult': 2.5
		},
		'assassin': {
			'mainStat': 'dex',
			'weapons': 1,
			'twoHanded': false,
			'maxArmorReduc': 20,
			'healthMult': 1.9
		},
		//INT Classes
		'frostMage': {
			'mainStat': 'int',
			'weapons': 1,
			'twoHanded': true,
			'maxArmorReduc': 25,
			'healthMult': 2
		},
		'fireMage': {
			'mainStat': 'int',
			'weapons': 1,
			'twoHanded': true,
			'maxArmorReduc': 20,
			'healthMult': 1.8
		},
		'bloodMage': {
			'mainStat': 'int',
			'weapons': 1,
			'twoHanded': true,
			'maxArmorReduc': 20,
			'healthMult': 1.8
		},
		'darkMage': {
			'mainStat': 'int',
			'weapons': 1,
			'twoHanded': true,
			'maxArmorReduc': 20,
			'healthMult': 1.9
		}
	}

	function startRecursiveSimulation(){
		var output = document.getElementById('outputPlayerStats')
		var allClasses = Object.keys(classes)
		var allArmorTypes = []
		var allGearRarities = []
		
		var armorTypes = document.getElementById('p1GearType')
		var rarityTypes = document.getElementById('p1GearRarity')

		for(var i=0; i<armorTypes.options.length; i++)
			allArmorTypes[i] = armorTypes.options[i].value

		//COMMENT to only see end-game "Mythic" values
		for(var i=0; i<rarityTypes.options.length; i++)
			allGearRarities[i] = rarityTypes.options[i].value
		//UNCOMMENT to only see end-game "Mythic" values
		//allGearRarities = ['mythic']

		//console.log(allClasses)
		//console.log(allArmorTypes)
		//console.log(allGearRarities)

		for(var a=0; a<allClasses.length; a++){
			document.getElementById('p1Class').value = allClasses[a]
			//Set raatios of stats the class would want
			getBaseStatRatios(allClasses[a])

			for(var b=0; b<allArmorTypes.length; b++){
				document.getElementById('p1GearType').value = allArmorTypes[b]

				for(var c=0; c<allGearRarities.length; c++){
					document.getElementById('p1GearRarity').value = allGearRarities[c]

					var player = startSimulation()
					var excelOutput = getExcelOutput(player)

					output.value += excelOutput + ' \n'
				}
			}
		}
	}

	function startSimulation(){
		var player1 = createPlayer('1')
		var player2 = createPlayer('2')
		//JUST FOR DEBUGGING
		player1['name'] = '----- (' + player1['class'] + ')'
		player2['name'] = '+++++ (' + player2['class'] + ')'

		//Calculate Base Stats
		calculateStats(player1)
		calculateStats(player2)

		//Multiply Armor by the Equipment Type Multiplier
		calculateArmorMultiplier(player1)
		calculateArmorMultiplier(player2)

		//Multiply Armor by the Rarity Type Multiplier
		calculateArmorRarityMultiplier(player1)
		calculateArmorRarityMultiplier(player2)

		//Multiply Stats by the Equipment Stats Multiplier
		calculateStatsMultiplier(player1)
		calculateStatsMultiplier(player2)

		//Multiply Stats by the Rarity Multiplier
		calculateStatsRarityMultiplier(player1)
		calculateStatsRarityMultiplier(player2)

		//Put everything together to get the final stats
		//calculateFinalStats(player1)
		//calculateFinalStats(player2)
		calculateFinalStatsWithResist(player1, player2)
		calculateFinalStatsWithResist(player2, player1)

		//Start the battle(s)
		setupFight(player1, player2)


		return player1
	}

	function setupFight(player1, player2){
		var simulations = document.getElementById('simulations').value
		
		var player1Wins = 0

		console.log(player1)
		console.log(player2)
		for(var i=0; i<simulations; i++){
			var random = Math.random()
			var winner

			//Decide who goes first - 50/50
			if(random > 0.5)
				winner = processFight(player1, player2)
			else	
				winner = processFight(player2, player1)

			if(winner['name'] == '----- (' + player1['class'] + ')')
				player1Wins++;
		}

		console.log("\n[FINAL] Player 1 Wins: " + player1Wins + " Player 2 Wins: " + (simulations - player1Wins) + '\n\n')
	}

	function processFight(player1, player2){
		//Copy player arrays so we can manipulate them only for this fight
		var p1 = {...player1}
		var p2 = {...player2}

		//Goes up by 20% each turn (+0.2 each turn)
		p1['turnDmg'] = 1.0
		p2['turnDmg'] = 1.0

		var decider = 0
		var attacker
		var defender

		//Holds max health to ensure lifesteal/ressurection doesn't go over
		p1['maxHealth'] = p1['health']
		p2['maxHealth'] = p2['health']

		//Tracks the turn of a rogue since they essentially take two turns
		var hasAttackedTwice = false

		//Fencer immediately removes 15% armor reduction
		p1['class'] == 'fencer' ? p2['armorReduction'] -= 15.0 : ''
		p2['class'] == 'fencer' ? p1['armorReduction'] -= 15.0 : ''

		//Mages ignore armor
		classes[p1['class']]['mainStat'] == 'int' ? p2['armorReduction'] = 0 : ''
		classes[p2['class']]['mainStat'] == 'int' ? p1['armorReduction'] = 0 : ''

		//Make sure armor reduction isn't negative
		p1['armorReduction'] < 0 ? p1['armorReduction'] = 0 : ''
		p2['armorReduction'] < 0 ? p2['armorReduction'] = 0 : ''

		console.log('-------------BATTLE START-------------')

		//Begin fight
		while(p1['health'] > 0 && p2['health'] > 0){
			if(decider == 0){
				attacker = p1
				defender = p2
			}
			else{
				attacker = p2
				defender = p1
			}

			//Reset crit damage every turn before damage calculation
			p1['critDmg'] = 0
			p2['critDmg'] = 0

			//Check for evasion and blocking
			var doesDefenderEvadeOrBlock = false
			var defenderClass = defender['class']

			if(defenderClass == 'scout' || defenderClass == 'rogue' || defenderClass == 'assassin' || defenderClass == 'warrior')
				doesDefenderEvadeOrBlock = checkEvadeOrBlock(attacker, defender)

			//If there was no evasion or block
			if(!doesDefenderEvadeOrBlock){

				//Magic knight reduces armor reduction by 2.5%
				if(attacker['class'] == 'magicKnight'){
					defender['armorReduction'] -= 2.5
					console.log('[CLASS] ' + attacker['name'] + ' has reduced the opponents armor by 2.5%. NOW: ' + defender['armorReduction'])
				}
				//Make sure the armor reduction isn't negative
				defender['armorReduction'] < 0 ? defender['armorReduction'] = 0 : ''

				//Check for critical hits
				var isHitCritical = checkCriticalHit(attacker, defender)

				if(isHitCritical){
					console.log(attacker['name'] + ' is going to CRITICALLY hit!')
					processCriticalHit(attacker, defender)
				}

				//Total up the damage including ( [baseDmg + critDmg] * turnDmg )
				var baseDmg = attacker['dmg']

				//Berserker takes 2x damage from mages
				if(classes[attacker['class']]['mainStat'] == 'int' && defender['class'] == 'berserker')
					baseDmg *= 2

				var attackerDamage = Math.floor((baseDmg + attacker['critDmg']) * attacker['turnDmg'])

				defender['health'] -= attackerDamage
				console.log('[HIT] ' + attacker['name'] + ' hits for ' + attackerDamage + ' damage || ' + defender['name'] + ' has ' + defender['health'] + ' health')

				//Check resurrect
				checkResurrection(defender)
			}

			//Change the turn over to the other player
			decider == 0 ? decider = 1 : decider = 0
			
			//Rogues attack twice - so change the decider back
			if(attacker['class'] == 'rogue'){
				if(hasAttackedTwice == false){
					decider == 0 ? decider = 1 : decider = 0

					hasAttackedTwice = true
				}
				//Set the counter back for the next time its the rogue's turn
				else
					hasAttackedTwice = false
			}

			//Berserkers have a 50% chance to attack again
			if(attacker['class'] == 'berserker'){
				if(Math.random() >= 0.5)
					decider == 0 ? decider = 1 : decider = 0
			}

			//If attacker is a fire mage, increase damage by 35% not 20%
			attacker['class'] == 'fireMage' ? attacker['turnDmg'] += 0.35 : attacker['turnDmg'] += 0.2
		}

		if(p1['health'] <= 0){
			console.log('[FINAL] Player 1 WINS!')
			return player1
		}
		else{
			console.log('[FINAL] Player 2 WINS!')
			return player2
		}
		
	}

	function checkEvadeOrBlock(attacker, defender){
		var evadeBlockChance = 0.5

		//Cannot evade magical attacks unless the defender is a scout
		if(classes[attacker['class']]['mainStat'] == 'int' && defender['class'] != 'scout')
			return false
		else{
			//Scouts can evade magical attacks, but only with a 25% chance
			if(defender['class'] == 'scout')
				evadeBlockChance -= 0.25
			
			if(evadeBlockChance < Math.random()){
				console.log(defender['name'] + ' dodged/blocked!')
				return true
			}
			else
				return false
		}
	}

	//Demon hunters can ressurect
	function checkResurrection(defender){
		if(defender['health'] <= 0 && defender['class'] == 'demonHunter'){
			if(Math.random() < 0.25)
				defender['health'] = defender['maxHealth']
		}
	}


	//Return whether the hit was critical or not
	function checkCriticalHit(attacker, defender){
		var critChance = attacker['critChance']
		var random = Math.random() * 100
		
		//Frost mages drop the critical chance of foes
		if(defender['class'] == 'frostMage'){
			critChance -= 25
		}

		if(critChance > random)
			return true
		else
			return false
	}

	//
	function processCriticalHit(attacker, defender){
		var baseDmg = attacker['dmg']
		
		if(attacker['critChance'] > Math.random()){
			if(attacker['class'] == 'assassin')
				attacker['critDmg'] = baseDmg * 3
			else if(attacker['class'] == 'darkMage'){
				if(Math.random() > 0.5){
					attacker['health'] += Math.floor(baseDmg / 3)
					//Make sure health doesn't go over max
					attacker['health'] > attacker['maxHealth'] ? attacker['health'] = attacker['maxHealth'] : ''
				}
			}
			else if(attacker['class'] == 'bloodMage'){
				attacker['health'] += Math.floor(baseDmg / 2)
				//Make sure health doesn't go over max
				attacker['health'] > attacker['maxHealth'] ? attacker['health'] = attacker['maxHealth'] : ''
			}
			else
				attacker['critDmg'] = baseDmg * 2
		}
	}

	//===============================
	//	Helper Functions
	//===============================


	//Creates and returns the base player dictionary that we will later manipulate
	function createPlayer(playerNum){
		var player = {
			'name': 'player' + playerNum,
			'level': document.getElementById('p' + playerNum + 'Level').value,
			'class': document.getElementById('p' + playerNum + 'Class').value,
			'strPerLvl': document.getElementById('p' + playerNum + 'Strength').value,
			'dexPerLvl': document.getElementById('p' + playerNum + 'Dexterity').value,
			'intPerLvl': document.getElementById('p' + playerNum + 'Intelligence').value,
			'conPerLvl': document.getElementById('p' + playerNum + 'Consitution').value,
			'lukPerLvl': document.getElementById('p' + playerNum + 'Luck').value,
			'gearType': document.getElementById('p' + playerNum + 'GearType').value,
			'gearRarity': document.getElementById('p' + playerNum + 'GearRarity').value
		}
		return player
	}


	//Calculate the base stats based on given stat ratios
	function calculateStats(player){
		var level = player['level']
		
		player['str'] = level * player['strPerLvl']
		player['dex'] = level * player['dexPerLvl']
		player['int'] = level * player['intPerLvl']
		player['con'] = level * player['conPerLvl']
		player['luk'] = level * player['lukPerLvl']
		player['armor'] = level * 15
	}


	//Apply the gear type multipliers to the players armor
	function calculateArmorMultiplier(player){
		var gearType = player['gearType']
		var armorMultiplier = document.getElementById(gearType + 'ArmorPerLvl').value

		player['armor'] = Math.floor(player['armor'] * armorMultiplier)
	}


	//Apply the rarity multipliers to the players armor
	function calculateArmorRarityMultiplier(player){
		var rarityType = player['gearRarity']
		var rarityMultiplier = document.getElementById(rarityType).value

		player['armor'] = Math.floor(player['armor'] * rarityMultiplier)
	}


	//Apply the gear type multipliers to the player stats
	function calculateStatsMultiplier(player){
		var gearType = player['gearType']
		var statsMultiplier = document.getElementById(gearType + 'ArmorStatsPerLvl').value

		player['str'] = Math.floor(player['str'] * statsMultiplier)
		player['dex'] = Math.floor(player['dex'] * statsMultiplier)
		player['int'] = Math.floor(player['int'] * statsMultiplier)
		player['con'] = Math.floor(player['con'] * statsMultiplier)
		player['luk'] = Math.floor(player['luk'] * statsMultiplier)
	}


	//Apply the rarity multipliers to the player stats
	function calculateStatsRarityMultiplier(player){
		var rarityType = player['gearRarity']
		var rarityMultiplier = document.getElementById(rarityType).value

		player['str'] = Math.floor(player['str'] * rarityMultiplier)
		player['dex'] = Math.floor(player['dex'] * rarityMultiplier)
		player['int'] = Math.floor(player['int'] * rarityMultiplier)
		player['con'] = Math.floor(player['con'] * rarityMultiplier)
		player['luk'] = Math.floor(player['luk'] * rarityMultiplier)
	}


	//After all of the base stats and multipliers are calculated, convert them into the meaningful stats (DMG, Health, Crit Chance, etc)
	function calculateFinalStats(player){
		var level = player['level']
		var pClass = player['class']
		var mainStat = classes[pClass]['mainStat']
		var classHPMultiplier = classes[pClass]['healthMult']
		var maxArmorReduction = classes[pClass]['maxArmorReduc']
		 
		var maxCritChance = 30
		var maxCritChanceAssassin = 50
		var maxCritChanceFencer = 60
		
		if(level <= 5){
			calculateDamage(player, level, pClass, mainStat, 20)
			player['health'] = classHPMultiplier * (level ** 2) * 4 * Math.floor(player['con']/20) + 60
		} else {
			calculateDamage(player, level, pClass, mainStat, 30)
			player['health'] = classHPMultiplier * (level ** 2) * 4 * Math.floor(player['con']/30) + 60
		}

		player['armorReduction'] = ((player['armor'])/(level * 60) * 100).toFixed(1)

		//Check for max armor reduction based on class
		if(player['armorReduction'] > maxArmorReduction){
			player['armorReduction'] = maxArmorReduction
		}

		player['critChance'] = ((player['luk'])/(level * 60) * 100).toFixed(1)

		if(pClass == 'assassin'){
			player['critChance'] = parseFloat(player['critChance']) + 15.0

			if(player['critChance'] > 50)
				player['critChance'] = 50

		}
		else if(pClass == 'fencer'){				
			player['critChance'] = parseFloat(player['critChance']) + 25.0

			if(player['critChance'] > 60)
				player['critChance'] = 60
		}
		else{
			if(player['critChance'] > 30)
				player['critChance'] = 30
		}

		player['strResistance'] = Math.floor(player['str'] / 2)
		player['dexResistance'] = Math.floor(player['dex'] / 2)
		player['intResistance'] = Math.floor(player['int'] / 2)
	}


	//Same as calculateFinalStats but takes armor resistance in account for the damage calculation
	function calculateFinalStatsWithResist(player, otherPlayer){
		var level = player['level']
		var pClass = player['class']
		var mainStat = classes[pClass]['mainStat']
		var classHPMultiplier = classes[pClass]['healthMult']
		var maxArmorReduction = classes[pClass]['maxArmorReduc']
		 
		var maxCritChance = 30
		var maxCritChanceAssassin = 50
		var maxCritChanceFencer = 60
		
		otherPlayer['strResistance'] = Math.floor(otherPlayer['str'] / 2)
		otherPlayer['dexResistance'] = Math.floor(otherPlayer['dex'] / 2)
		otherPlayer['intResistance'] = Math.floor(otherPlayer['int'] / 2)

		if(level <= 5){
			//calculateDamage(player, level, pClass, mainStat, 20)
			calculateDamageWithResist(player, otherPlayer, level, pClass, mainStat, 20)
			player['health'] = classHPMultiplier * (level ** 2) * 4 * Math.floor(player['con']/20) + 60
		} else {
			//calculateDamage(player, level, pClass, mainStat, 30)
			calculateDamageWithResist(player, otherPlayer, level, pClass, mainStat, 30)
			player['health'] = classHPMultiplier * (level ** 2) * 4 * Math.floor(player['con']/30) + 60
		}

		player['armorReduction'] = ((player['armor'])/(level * 60) * 100).toFixed(1)

		//Check for max armor reduction based on class
		if(player['armorReduction'] > maxArmorReduction){
			player['armorReduction'] = maxArmorReduction
		}

		player['critChance'] = ((player['luk'])/(level * 60) * 100).toFixed(1)

		if(pClass == 'assassin'){
			player['critChance'] = parseFloat(player['critChance']) + 15.0

			if(player['critChance'] > 50)
				player['critChance'] = 50

		}
		else if(pClass == 'fencer'){				
			player['critChance'] = parseFloat(player['critChance']) + 25.0

			if(player['critChance'] > 60)
				player['critChance'] = 60
		}
		else{
			if(player['critChance'] > 30)
				player['critChance'] = 30
		}

		player['strResistance'] = Math.floor(player['str'] / 2)
		player['dexResistance'] = Math.floor(player['dex'] / 2)
		player['intResistance'] = Math.floor(player['int'] / 2)
	}


	//Calculates the damage of a player based on # of weapons, weapon types, and level
	function calculateDamage(player, level, pClass, mainStat, divisor){
		var weaponType = mainStat
		var weaponMultiplier = document.getElementById(weaponType + 'Weapon').value
		var numOfWeapons = classes[pClass]['weapons']
		var isTwoHanded = classes[pClass]['twoHanded']

		if(numOfWeapons == 2)
			player['dmg'] = Math.floor(0.65 * (level ** 2) * (player[mainStat]/divisor)) + 10
		else if(isTwoHanded)
			player['dmg'] = Math.floor((level ** 2) * (player[mainStat]/divisor)) + 10
		else
			player['dmg'] = Math.floor(0.5 * (level ** 2) * (player[mainStat]/divisor)) + 10

		player['dmg'] = player['dmg'] * weaponMultiplier
	}

	//Calculates the damage of a player based on # of weapons, weapon types, and level
	function calculateDamageWithResist(player, otherPlayer, level, pClass, mainStat, divisor){
		var weaponType = mainStat
		var weaponMultiplier = document.getElementById(weaponType + 'Weapon').value
		var newMainStat
		var numOfWeapons = classes[pClass]['weapons']
		var isTwoHanded = classes[pClass]['twoHanded']

		//If enemy has >= of the players main stat, damage reduction is capped at 50 
		if(otherPlayer[mainStat] >= player[mainStat])
			newMainStat = Math.floor(player[mainStat]/2)
		else
			newMainStat = player[mainStat] - Math.floor(otherPlayer[mainStat + 'Resistance'])

		if(numOfWeapons == 2)
			player['dmg'] = Math.floor(1.05 * (level ** 2) * (newMainStat/divisor)) + 10
		else if(isTwoHanded)
			player['dmg'] = Math.floor((level ** 2) * (newMainStat/divisor)) + 10
		else
			player['dmg'] = Math.floor(0.5 * (level ** 2) * (newMainStat/divisor)) + 10

		player['dmg'] = player['dmg'] * weaponMultiplier
	}


	//Sets the base stats ratios based on main stat type - purely for simulation purposes
	function getBaseStatRatios(pClass){
		var mainStat = classes[pClass]['mainStat']
		var statArr = [] //[str,dex,int,con,luk]

		if(mainStat == 'str')
			statArr = [20,5,5,17,13]
		if(mainStat == 'dex')
			statArr = [5,20,5,15,15]
		if(mainStat == 'int')
			statArr = [5,5,20,13,17]

		document.getElementById('p1Strength').value = statArr[0]
		document.getElementById('p1Dexterity').value = statArr[1]
		document.getElementById('p1Intelligence').value = statArr[2]
		document.getElementById('p1Consitution').value = statArr[3]
		document.getElementById('p1Luck').value = statArr[4]
	}


	//Formats the player data specifically to output to Excel
	function getExcelOutput(player){
		var output = player['level'] + '\t'
		+ player['class'] + '\t'
		+ player['gearType'] + '\t'
		+ player['gearRarity'] + '\t'
		+ player['str'] + '\t'
		+ player['dex'] + '\t'
		+ player['int'] + '\t'
		+ player['con'] + '\t'
		+ player['luk'] + '\t'
		+ player['armor'] + '\t'
		+ player['armorReduction'] + '\t'
		+ player['critChance'] + '\t'
		+ player['dmg'] + '\t'
		+ player['health'] + '\t'
		+ player['strResistance'] + '\t'
		+ player['dexResistance'] + '\t'
		+ player['intResistance'] + '\t'

		return output
	}

	//===============================
	// CALCULATIONS
	//===============================

	var output = ''
	var total = 0
	var total2 = 0
	var total3 = 0
	var questXp = 0

	for(var i=1; i<=100; i++){
		var gold = (i ** 3) + 300
		var statCost = Math.floor((i ** 2.2)/20 + 1)
		var xp = Math.floor((i ** 2) * i ** 1.3) + 50
		questXp = Math.floor((i ** 2)) + 10
		var questsNeeded = Math.floor(xp / questXp)
		total += gold
		total2 += statCost
		total3 += xp
		output += i + '\t' + gold + '\t' + total + '\t' + statCost + '\t' + total2 + '\t' + xp + '\t' + total3 + '\t' + questXp + '\t' + questsNeeded + '\n'
	}
	//document.getElementById('output').value = output
	
	var output2 = ''

	for(var i=1; i<=100; i++){
		//wpn dmg * str stat + 10
		var mainStat = (i*20)
		var conStat = (i*15)
		var dmg
		if(i<5)
			dmg = (i ** 2) * Math.floor(mainStat/20) + 10
		else
			dmg = (i ** 2) * Math.floor(mainStat/30) + 10
		var health
		if(i<5)
			health = (i ** 2) * 4 * Math.floor(conStat/20) + 60
		else
			health = (i ** 2) * 4 * Math.floor(conStat/30) + 60
		var armor = (i*15)/(i*60) * 100
		var critChance = (i*15)/(i*60) * 100
		var res1 = (i*5) / 2 //times by two for both stats
		var newMainStat = mainStat - res1
		var newDmg
		if(i<5)
			newDmg = (i ** 2) * Math.floor(newMainStat/20) + 10
		else
			newDmg = (i ** 2) * Math.floor(newMainStat/30) + 10

		output2 += i + '\t' + dmg + '\t' + health + '\t' + armor + '\t' + critChance + '\t' + mainStat + '\t' + res1 + '\t' + newMainStat + '\t' + newDmg + '\n'// + questsNeeded + '\n'
	}
	//document.getElementById('outputClassInfo').value = output2

</script>
</html>